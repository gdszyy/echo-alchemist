    
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+TC:wght@400;700&display=swap');

        body {
            background-color: #020617;
            color: #e2e8f0;
            font-family: 'Noto Serif TC', serif;
            overflow: hidden;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        #game-container {
            position: relative;
            width: 100%;
            
            /* --- 修改开始 --- */
            /* 兼容旧浏览器 */
            height: 100vh; 
            /* 核心修复：使用动态视口高度，自动减去地址栏高度 */
            height: 100dvh; 
            /* --- 修改结束 --- */

            background: #0f172a; 
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        @keyframes shake-hard {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-5px, 5px); }
            50% { transform: translate(5px, -5px); }
            75% { transform: translate(-5px, -5px); }
            100% { transform: translate(0, 0); }
        }
        .shake-hard { animation: shake-hard 0.2s; }
        /* --- [新增] 技能点宝石样式 --- */
        .sp-slot {
            width: 20px;
            height: 20px;
            background: rgba(15, 23, 42, 0.6); /* 深色底槽 */
            border: 2px solid #475569;         /* 边框 */
            transform: rotate(45deg);          /* 旋转成菱形 */
            position: relative;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }

        /* 宝石本体 */
        .sp-gem {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #34d399 0%, #059669 100%); /* 翡翠绿宝石 */
            box-shadow: 0 0 8px #10b981;
            opacity: 0;
            transform: scale(0);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* 弹性弹出动画 */
        }

        /* 激活状态 */
        .sp-gem.active {
            opacity: 1;
            transform: scale(0.8); /* 稍微留一点边框 */
        }

        /* 获得宝石时的闪光特效 */
        @keyframes gemFlash {
            0% { filter: brightness(2); transform: scale(1.2) rotate(45deg); }
            100% { filter: brightness(1); transform: scale(1) rotate(45deg); }
        }
        .sp-slot.flash {
            animation: gemFlash 0.3s ease-out;
            border-color: #34d399;
        }

        /* Animated Phase Title */
        #phase-title-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 100;
            text-align: center;
            width: 100%;
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        #phase-title-container.minimized {
            top: max(20px, env(safe-area-inset-top));
            left: 20px;
            transform: translate(0, 0) scale(0.4);
            transform-origin: top left;
            opacity: 0.6;
        }
        /* --- [新增] 英雄充能条样式 --- */
        /* --- [修改] 英雄充能条样式 --- */
#hero-gauge-container {
    /* 1. 位置提升：远离底部面板 (原100px -> 145px) */
    bottom: 145px; 
    
    /* 2. 确保层级 */
    z-index: 80;
    
    /* 3. 基础阴影 (会被 JS 动态覆盖，但作为兜底) */
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
    
    /* 4. 这里的 transition 负责处理 CSS 类的变化（如受击震动），
       而位置的移动将由 JS 每帧驱动以保证跟手 */
    transition: filter 0.2s, opacity 0.2s;
    
    /* 确保它不会拦截鼠标事件，让你可以点到后面的球 */
    pointer-events: none;
}


        /* 受击时的弹性震动 */
        .gauge-shake {
            animation: gaugeBump 0.2s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
        }

        @keyframes gaugeBump {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); filter: brightness(1.3); }
            100% { transform: translateX(-50%) scale(1); }
        }

        /* --- 1. 修复：双向流淌的能量脉冲 (Dual Flow Border) --- */
        #gauge-pulse-layer {
            position: absolute;
            inset: -2px; /* 包住边缘 */
            border-radius: 9999px;
            pointer-events: none;
            z-index: 50; /* 浮在最上层 */
            
            /* 核心：挖空中间，只留 3px 边框用于显示光流 */
            -webkit-mask: 
                linear-gradient(#fff 0 0) content-box, 
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            padding: 3px; /* 光流粗细 */
            
            opacity: 0; /* 默认隐藏 */
            mix-blend-mode: screen; /* 滤色模式，让光更亮 */
        }

        /* 激活状态 */
        #gauge-pulse-layer.pulse-active {
            opacity: 1;
            transition: opacity 0s;
        }
        #gauge-pulse-layer:not(.pulse-active) {
            transition: opacity 0.5s ease-out;
        }

        /* --- 左侧流光 (逆时针) --- */
        #gauge-pulse-layer::before {
            content: '';
            position: absolute;
            inset: -50%; /* 扩大范围以覆盖旋转 */
            
            /* 渐变：白色头 -> 颜色 -> 透明尾巴 */
            /* 放在 0deg (12点钟方向) */
            background: conic-gradient(
                from 0deg, 
                #ffffff 0%, 
                var(--pulse-color, #fbbf24) 10%, 
                transparent 35%
            );
            
            opacity: 0; 
            transform: rotate(0deg); 
        }

        /* --- 右侧流光 (顺时针) --- */
        #gauge-pulse-layer::after {
            content: '';
            position: absolute;
            inset: -50%;
            
            /* 渐变：镜像逻辑，尾巴在前，白色头在后 (接近 360deg) */
            background: conic-gradient(
                from 0deg, 
                transparent 65%, 
                var(--pulse-color, #fbbf24) 90%, 
                #ffffff 100%
            );
            
            opacity: 0;
            transform: rotate(0deg);
        }

        /* 激活时的动画 */
        #gauge-pulse-layer.pulse-active::before {
            opacity: 1;
            /* 左边：逆时针旋转 0 -> -180度 (到达底部) */
            animation: flowLeft 0.6s cubic-bezier(0.1, 0.5, 0.1, 1) forwards;
        }

        #gauge-pulse-layer.pulse-active::after {
            opacity: 1;
            /* 右边：顺时针旋转 0 -> 180度 (到达底部) */
            animation: flowRight 0.6s cubic-bezier(0.1, 0.5, 0.1, 1) forwards;
        }

        @keyframes flowLeft {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-180deg); }
        }

        @keyframes flowRight {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(180deg); }
        }

        /* --- 2. 修复：进度条与光泽遮罩 (解决高光跑偏问题) --- */
        /* 进度条外壳 */
        /* --- CSS 修改开始 --- */

/* 进度条外壳 */
#gauge-shell {
    position: relative;
    overflow: hidden; 
    transform: translateZ(0);
    background: rgba(15, 23, 42, 0.95);
    border-radius: 9999px;
    
    /* [核心修复]：使用线性遮罩 */
    /* 之前的径向遮罩(radial)在长条容器上会导致两端被"切掉"，*/
    /* 改为线性遮罩(linear)可以完美覆盖整个长度，同时修复圆角溢出问题。 */
    -webkit-mask-image: -webkit-linear-gradient(#fff, #fff);
    mask-image: linear-gradient(#fff, #fff);
}

/* [新增]：全局玻璃扫光 (移到 Shell 上) */
#gauge-shell::after {
    content: '';
    position: absolute;
    top: 0; left: 0; bottom: 0; right: 0;
    
    /* 修改：宽度设为 100% 即可，配合 transform */
    width: 100%; 
    
    /* 调整渐变：增强中间的亮度，两侧透明 */
    background: linear-gradient(
        110deg, 
        transparent 35%, 
        rgba(255, 255, 255, 0.1) 40%, 
        rgba(255, 255, 255, 0.8) 50%, 
        rgba(255, 255, 255, 0.1) 60%, 
        transparent 65%
    );
    
    /* 动画设置 */
    animation: glassShine 3s infinite ease-in-out;
    
    z-index: 10; 
    pointer-events: none;
    mix-blend-mode: overlay; 
}

/* 优化后的动画关键帧 */
@keyframes glassShine {
    0% { 
        /* 从完全左侧外开始 (-100% 自身宽度) */
        transform: translateX(-100%); 
    }
    60% { 
        /* 扫到完全右侧外 (+100% 自身宽度) */
        /* 增加到 60% 的时间占比，让扫光稍微慢一点点，更优雅 */
        transform: translateX(100%); 
    }
    100% { 
        /* 保持在右侧外，等待下一次循环 (留白时间) */
        transform: translateX(100%); 
    } 
}

/* --- CSS 修改结束 --- */


        /* 进度条本体 */
        #hit-bar {
            position: relative;
            height: 100%;
            width: 0%;
            /* 进度条不再负责高光，只负责颜色 */
            background: linear-gradient(90deg, #0891b2, #22d3ee); 
            transition: width 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1; /* 放在底层 */
        }
        
        /* 满能量时的变色 */
        #hit-bar.bar-full {
            background: linear-gradient(90deg, #d97706, #fbbf24, #fff);
            box-shadow: 0 0 15px #fbbf24;
        }

        /* 内部高光 (Shimmy) - 修复位置锁定 */
        #hit-bar::after {
            content: none;
        }
        /* [新增]：全局玻璃扫光 (移到 Shell 上) */
        /* 这样高光就会扫过整个管子，两头都是圆的 */
        


        @keyframes barShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); } /* 扫得更远一点以确保完全离开 */
        }
        /* 进度条填充的高光流光 */
        #hit-bar::after {
            content: '';
            position: absolute;
            top: 0; left: 0; bottom: 0; width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transform: translateX(-100%);
            animation: shimmy 2s infinite;
        }
        @keyframes shimmy {
            100% { transform: translateX(200%); }
        }
        .phase-text {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            font-weight: bold;
            color: #facc15;
            text-shadow: 0 0 30px rgba(250, 204, 21, 0.6);
            background: linear-gradient(to bottom, #fef08a, #ca8a04);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }
        .phase-sub {
            font-size: 1rem;
            color: #94a3b8;
            margin-top: 0.5rem;
            opacity: 1;
            transition: opacity 0.5s;
        }
        .minimized .phase-sub { opacity: 0; }

        /* UI Overlays */
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding-top: max(70px, env(safe-area-inset-top)); 
            padding-bottom: env(safe-area-inset-bottom);
            transition: opacity 0.3s;
        }

        /* Top Bar */
        .top-bar {
            position: absolute;
            top: max(10px, env(safe-area-inset-top));
            right: 10px; 
            display: flex;
            gap: 8px;
            z-index: 90;
            pointer-events: auto;
        }

        .stat-pill {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #475569;
            padding: 0.3rem 0.8rem;
            border-radius: 999px;
            font-family: 'Cinzel', serif;
            color: #e2e8f0;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 4px;
            backdrop-filter: blur(4px);
        }
        .stat-highlight { color: #facc15; font-weight: bold; }

        .btn-icon {
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid #475569;
            border-radius: 50%;
            color: #94a3b8;
            cursor: pointer;
        }

        /* Bottom Panel */
          .bottom-panel {
            /* 原来是 90px */
            height: 115px; 
            
            /* 保持其他样式不变 */
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(15, 23, 42, 0.98);
            border-top: 1px solid #475569;
            padding: 0 12px;
            padding-bottom: max(0px, env(safe-area-inset-bottom));
            pointer-events: auto;
            display: flex;
            align-items: center;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
            z-index: 50;
        }
        /* Hit Bar */
        .hit-container {
            display: flex; align-items: center; gap: 8px;
            font-size: 0.75rem; color: #94a3b8;
        }
        .hit-bar-bg {
            flex: 1; height: 8px; background: #334155; border-radius: 4px; overflow: hidden;
        }
        .hit-bar-fill {
            height: 100%; background: linear-gradient(90deg, #f59e0b, #fbbf24);
            width: 0%; transition: width 0.2s;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        /* Queue & Recipe */
        .queue-container {
            display: flex; align-items: center; gap: 4px;
            border-right: 1px solid #334155; padding-right: 10px;
            margin-right: 4px;
        }
        .queue-dot {
            width: 20px; height: 20px; border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Recipe Cards */
        .recipe-scroll {
            display: flex; 
            gap: 8px; 
            overflow-x: auto;
            scrollbar-width: none;
            
            /* 核心修改：强制不换行，且高度填满容器 */
            flex-wrap: nowrap; 
            height: 100%;
            align-items: center; /* 卡片垂直居中 */
            width: 100%;
            padding-right: 20px; /* 防止最后一个贴边 */
        }
        /* --- 新增：配方锁定/完成时的特效动画 --- */
        @keyframes recipeLockFlash {
            0% { 
                transform: scale(1); 
                background: rgba(50, 60, 90, 0.9); 
                box-shadow: 0 0 0px transparent;
            }
            50% { 
                transform: scale(1.15) translateY(-5px); 
                background: #fff; 
                border-color: #fff;
                box-shadow: 0 0 20px #fff; 
                z-index: 10;
            }
            100% { 
                transform: scale(1); 
                background: rgba(50, 60, 90, 0.9); 
                box-shadow: 0 0 0px transparent;
            }
        }
        .recipe-card {
            background: rgba(30, 41, 59, 0.6); /* 稍微增加透明度让它看起来轻盈点 */
            border: 1px solid #475569;
            border-radius: 6px;
            
            /* [优化]：减少内边距 (原 6px 10px) */
            padding: 4px 8px; 
            
            width: max-content;
            min-width: 80px; /* 稍微调小最小宽度 */
            height: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .mats-grid {
            display: grid;
            grid-template-rows: repeat(4, min-content); /* 保持4行 */
            grid-auto-flow: column; /* 超过4行自动换列 */
            
            /* [优化]：大幅减少行间距 (原 2px)，列间距保持 12px */
            gap: 0px 12px; 
            
            /* [优化]：减少顶部间距 (原 4px) */
            margin-top: 2px;
        }

        /* --- 4. 调整行文字样式 --- */
        .mat-row {
            display: flex;
            align-items: center;
            white-space: nowrap;
            
            /* [优化]：强制行高紧凑，防止文字自带的上下留白撑高 */
            line-height: 1.3; 
            
            /* [优化]：字体稍微调小一点点 (原默认可能是 0.7rem) */
            font-size: 0.65rem; 
        }
        .recipe-card.locked-anim {
            animation: recipeLockFlash 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .recipe-card.active {
            background: rgba(50, 60, 90, 0.9);
            border-color: #fbbf24;
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.1);
        }

        /* Selection Grid */
        .marble-grid {
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px;
            padding: 10px 20px; /* 减小上下 padding */
            pointer-events: auto;
            width: 100%;
            max-width: 400px; /* 限制最大宽度，防止在平板/PC上卡片太大 */
            margin: 0 auto;   /* 居中 */
        }
        .select-card {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid #475569;
            border-radius: 12px;
            /* 修改: 不强制宽高比，改用固定高度范围，更省空间 */
            /* aspect-ratio: 3/4; */ 
            height: 110px; /* 固定高度，防止被挤压或撑得太高 */
            
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s;
            position: relative;
        }
        .select-card.selected {
            border-color: #fbbf24; background: rgba(50, 60, 90, 0.9);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
            transform: translateY(-4px);
        }
        .select-icon {
            width: 40px; height: 40px; /* 稍微调小图标 */
            border-radius: 50%; margin-bottom: 6px;
            box-shadow: inset -2px -2px 6px rgba(0,0,0,0.5), 2px 2px 6px rgba(255,255,255,0.3);
            flex-shrink: 0;
        }

        /* Buttons */
        .btn-main {
            background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            color: white; font-family: 'Cinzel', serif;
            padding: 12px; border-radius: 8px; width: 80%;
            text-align: center; margin: 0 auto;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4);
            pointer-events: auto;
            transition: opacity 0.2s;
        }
        .btn-main:disabled { opacity: 0.5; filter: grayscale(1); }

        /* Toast */
        #toast {
            position: absolute; top: 20%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: #fff; padding: 8px 16px; border-radius: 20px;
            pointer-events: none; opacity: 0; transition: opacity 0.3s; z-index: 200;
            border: 1px solid #475569;
        }
        .toast-visible { opacity: 1 !important; }
        
        /*
        .recipe-hud-floating {
            position: absolute;
            bottom: max(20px, env(safe-area-inset-bottom)); 
            right: 16px;
            width: 160px; 
            display: flex;
            flex-direction: column-reverse;
            gap: 6px;
            pointer-events: auto; 
            z-index: 20;
        }
        .recipe-card.current {
            background: rgba(50, 60, 90, 0.9);
            border-color: #fbbf24;
            box-shadow: 0 0 8px rgba(251, 191, 36, 0.2);
            transform: scale(1.05);
        }
        .recipe-card.queue { opacity: 0.5; transform: scale(0.95); }
        */
        /* 战斗阶段 HUD 浮动容器 */
        /* 战斗阶段 HUD 浮动容器 */
        .recipe-hud-floating {
            position: absolute;
            
            /* 1. 垂直定位：底部与炮台基座(bottom:80px)视觉平齐 */
            bottom: 80px; 
            
            /* 2. 水平定位：屏幕中心 */
            left: 50%;
            /* 向左偏移：将容器移动到炮台左侧 (数值可微调，-220px 比较合适) */
            transform: translateX(-220px); 
            
            width: 140px;
            display: flex;
            
            /* 3. 核心：反向排列，让第一个元素(当前弹药)沉在最下面 */
            flex-direction: column-reverse; 
            
            gap: 6px; 
            pointer-events: none;
            z-index: 40;
            
            /* 4. 靠右对齐 (靠向炮台一侧) */
            align-items: flex-end; 
        }

        /* 當前彈藥卡片 */
        .recipe-card.current {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid #fbbf24;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            opacity: 1;
        }

        /* 隊列中的彈藥卡片 */
        .recipe-card.queue {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid #475569;
            transform: scale(0.95);
            opacity: 0.6;
        }
        .mat-row { display: flex; align-items: center; margin-top: 2px; }
        
        /* Ammo Queue Dots */
        .ammo-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin: 0 2px;
            border: 1px solid #fff;
            opacity: 0.3;
            background: rgba(255,255,255,0.1);
        }
        .ammo-indicator.active { opacity: 1; box-shadow: 0 0 5px #fff; background: #fff; }
        /* --- 遗物界面容器 --- */
        #phase-relic {
            /* 强制开启鼠标事件，覆盖 .ui-overlay 的 pointer-events: none */
            pointer-events: auto !important; 
            
            /* 确保层级最高，不被其他 UI 遮挡 */
            z-index: 999 !important; 
            
            /* 之前的样式保持不变... */
            overflow-y: auto; 
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            background: rgba(2, 6, 23, 0.95); /* 确保背景有颜色，阻挡误触下方 */
        }
        .ammo-stage {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            width: 100%;
            position: relative;
            padding: 10px 0;
        }

        .ammo-slot-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .ammo-label {
            font-size: 0.65rem;
            color: #94a3b8;
            margin-bottom: 4px;
            font-family: 'Cinzel', serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ammo-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid #475569;
            background: rgba(15, 23, 42, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

         /* 简单的 Tab 切换样式 */
        .tab-btn.active {
            color: #fbbf24; /* amber-400 */
            border-bottom-color: #fbbf24;
        }
        .tab-btn:not(.active) {
            border-bottom-color: transparent;
        }
        .safe-area-pb {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* 当前发射槽位 - 高亮 */
        #current-slot .ammo-icon {
            width: 64px;
            height: 64px;
            border-color: #fbbf24;
            background: radial-gradient(circle, rgba(50, 60, 90, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.2);
        }

        /* 下一发槽位 - 稍微暗淡 */
        #next-slot .ammo-icon {
            opacity: 0.7;
            transform: scale(0.9);
        }

        /* 发射动画：当前子弹飞出 */
        .shoot-anim {
            animation: shootUp 0.4s forwards cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes shootUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-30px) scale(1.2); opacity: 0.5; }
            100% { transform: translateY(-60px) scale(0.5); opacity: 0; }
        }

        /* 进位动画：下一发滑动变大 */
        .slide-in-anim {
            animation: slideIn 0.4s forwards;
        }

        @keyframes slideIn {
            0% { transform: translateX(40px) scale(0.8); opacity: 0; }
            100% { transform: translateX(0) scale(1); opacity: 1; }
        }

        /* 之前旧的 queue 样式可以保留作为备用，或者隐藏 */
        #ammo-queue { display: none; }
        #relic-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: stretch; /* 让卡片高度一致 */
            gap: 12px; /* 减小间距 */
            width: 100%;
            max-width: 900px;
            margin-bottom: 20px;
        }
        .recipe-multicast-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 24px;
            height: 24px;
            background-color: #f97316; /* Orange-500 */
            border: 2px solid #fff;
            border-radius: 50%;
            color: white;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            z-index: 10;
            
            /* 默認隱藏 (縮小到0) */
            transform: scale(0); 
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .recipe-multicast-badge.visible {
            transform: scale(1);
        }
        /* --- [新增] 連射倍率特效 --- */
        .flying-badge {
            position: fixed; /* 使用 fixed 以便跨容器定位 */
            z-index: 9999;
            pointer-events: none;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            color: #ffedd5; /* Orange-100 */
            background: rgba(249, 115, 22, 0.9); /* Orange-500 */
            border: 2px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px #f97316;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); /* 平滑飛行曲線 */
        }
        /* 激活狀態：顯示出來 */
        .multicast-visible {
            opacity: 1 !important;
            transform: scale(1) !important;
        }
        /* 到達目標時的消失狀態 */
        .flying-badge.arrived {
            transform: scale(0.5);
            opacity: 0;
        }
        /* 獲得加成時的強力彈跳 */
        @keyframes multicastPopAnim {
            0% { transform: scale(1); }
            40% { transform: scale(1.8) rotate(10deg); filter: brightness(1.5); }
            80% { transform: scale(0.9); }
            100% { transform: scale(1) rotate(0); }
        }
        .multicast-pop {
            animation: multicastPopAnim 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* 數值變化時的顏色閃光 */
        .multicast-flash {
            color: #fff !important;
            text-shadow: 0 0 10px #fff, 0 0 20px #fbbf24 !important;
        }
        /* --- 卡片样式优化 (更紧凑) --- */
        .relic-card {
            pointer-events: auto;
            cursor: pointer;
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 12px; /* 减小内边距 (原20px) */
            
            /* 使用相对宽度，适配移动端 */
            width: 30%; 
            min-width: 130px; 
            max-width: 200px;
            
            min-height: 160px; /* 减小最小高度 (原240px) */
            
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .relic-card:hover {
            transform: translateY(-4px) scale(1.02);
            z-index: 10;
        }

        .relic-icon {
            font-size: 2.2rem; /* 缩小图标 (原3rem) */
            margin-bottom: 0.5rem;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.3));
        }

        .relic-name {
            font-family: 'Cinzel', serif;
            font-weight: bold;
            color: #e2e8f0;
            margin-bottom: 0.25rem;
            font-size: 0.95rem; /* 缩小字体 */
            line-height: 1.2;
        }

        .relic-desc {
            font-size: 0.75rem; /* 缩小描述字体 */
            color: #94a3b8;
            line-height: 1.3;
            
            /* 防止描述文字太长导致溢出，超过4行显示省略号 */
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* 稀有度光效 */
        .relic-card.rare { border-color: #3b82f6; } /* 蓝色 */
        .relic-card.rare:hover { box-shadow: 0 10px 30px -10px rgba(59, 130, 246, 0.3); }

        .relic-card.legendary { border-color: #facc15; } /* 金色 */
        .relic-card.legendary:hover { box-shadow: 0 10px 30px -10px rgba(250, 204, 21, 0.5); }

        .relic-card.cursed { border-color: #ef4444; } /* 红色 */
        .relic-card.cursed:hover { box-shadow: 0 10px 30px -10px rgba(239, 68, 68, 0.4); }
        /* --- 针对移动端横屏/矮屏幕的终极适配 --- */
        @media (max-height: 600px) {
            .select-card {
                height: 90px; /* 矮屏模式下卡片变矮 */
            }
            .select-icon {
                width: 32px; height: 32px; margin-bottom: 2px;
            }
            #phase-selection p {
                margin-bottom: 4px; /* 压缩文字间距 */
            }
            .relic-icon { font-size: 1.8rem; margin-bottom: 2px; }
            .relic-name { font-size: 0.85rem; }
            .relic-desc { -webkit-line-clamp: 3; } /* 横屏只显示3行 */
            
            /* 调整放弃按钮的位置 */
            #phase-relic button {
                pointer-events: auto;
                cursor: pointer;
                position: relative; /* 提升层级上下文 */
                z-index: 1000;
            }
        }

