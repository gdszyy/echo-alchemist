<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>回聲煉金師 (Echo Alchemist)</title>
    <link rel="stylesheet" href="./styles/main.css">
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>

    <!-- Phase Title Animation -->
    <div id="phase-title-container">
        <div id="phase-title" class="phase-text">回聲煉金師</div>
        <div id="phase-sub" class="phase-sub">點擊開始</div>
    </div>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="stat-pill">R <span id="round-num" class="stat-highlight">1</span></div>
        <div class="stat-pill">Score <span id="score-num" class="stat-highlight">0</span></div>
        <button id="speed-btn" class="btn-icon">⏩</button>
        <button id="mute-btn" class="btn-icon">🔊</button>
    </div>

    <div id="sp-panel" class="absolute top-16 left-4 flex flex-wrap gap-3 pointer-events-none z-50 transition-opacity duration-300">
    </div>

    <div id="toast"></div>

    <!-- Phase 0: Selection -->
    <div id="phase-selection" class="ui-overlay active-phase" style="display: flex;">
        <div class="flex-1 w-full min-h-0 overflow-y-auto flex flex-col items-center py-4">
            <div id="marble-selection-grid" class="marble-grid"></div>
            <div class="h-4 shrink-0"></div>
        </div>
        <div class="w-full flex flex-col items-center pointer-events-auto shrink-0 z-10 bg-slate-900/80 backdrop-blur-sm border-t border-slate-700/50 pt-4 pb-6"
             style="padding-bottom: max(24px, env(safe-area-inset-bottom));">
            <p class="text-sm text-slate-400 mb-3">已選擇: <span id="selected-count" class="text-white font-bold">0</span> / 3</p>
            <button id="confirm-selection-btn" class="btn-main" disabled>開始煉金</button>
        </div>
    </div>

    <!-- Phase 1: Gathering -->
    <div id="phase-gathering" class="ui-overlay" style="display: none;">
        <div class="absolute top-24 w-full text-center pointer-events-none">
            <p class="text-xs text-cyan-100/40">點擊上方區域釋放</p>
        </div>
        <div id="hero-gauge-container" class="absolute left-1/2 -translate-x-1/2 flex flex-col items-center justify-center pointer-events-none transition-all duration-300">
            <div class="text-[10px] text-cyan-200 tracking-widest mb-1 opacity-80 font-bold" style="text-shadow: 0 0 10px #06b6d4;">
                COMBO CHARGE
            </div>
            <div id="multicast-ui" class="absolute left-[110%] bottom-0 flex flex-col items-center justify-center transition-all duration-300 opacity-0 scale-50">
                <div class="text-[9px] text-orange-300 font-bold tracking-wider mb-1 whitespace-nowrap">SHOTS</div>
                <div class="relative flex items-center justify-center w-12 h-12">
                    <div class="absolute inset-0 bg-orange-500/20 rounded-full blur-md animate-pulse"></div>
                    <div class="absolute inset-0 border-2 border-orange-400 rounded-full opacity-80"></div>
                    <span id="multicast-num" class="relative text-2xl font-[Cinzel] font-bold text-orange-100 drop-shadow-[0_0_5px_#f97316]">x1</span>
                </div>
            </div>
            <div id="gauge-shell" class="relative w-48 h-5 bg-slate-900/90 rounded-full border border-slate-600/50 backdrop-blur-md shadow-lg">
                <div id="gauge-pulse-layer"></div>
                <div id="hit-bar"></div>
                <div class="absolute inset-0 flex items-center justify-center z-10">
                    <span id="hit-text" class="text-[10px] font-bold text-white drop-shadow-md tracking-wider">0/5</span>
                </div>
            </div>
        </div>
        <div class="bottom-panel">
            <div class="flex items-center w-full h-full">
                <div class="queue-container" id="gathering-queue"></div>
                <div class="flex-1 min-w-0 h-full">
                    <div id="gathering-hud-mount" class="recipe-scroll"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Phase 3: Combat -->
    <div id="phase-combat" class="ui-overlay" style="display: none;">
        <div id="skill-bar" class="absolute bottom-24 right-4 flex flex-col gap-3 pointer-events-auto z-50">
        </div>
        <div id="recipe-hud-container" class="absolute z-40 pointer-events-none"></div>
        <div class="text-center mt-4 pointer-events-none">
            <div id="multiplier-display" class="mt-2 text-2xl font-bold text-yellow-400 opacity-0 transition-opacity drop-shadow-md">
                COMBO <span id="multiplier-val">x1.0</span>
            </div>
        </div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none text-center w-full z-20 px-4" id="combat-message"></div>
    </div>

    <!-- Phase: Relic Selection -->
    <div id="phase-relic" class="ui-overlay hidden-phase" style="display: none; z-index: 200; background: rgba(2, 6, 23, 0.95);">
        <div class="flex flex-col items-center justify-center w-full h-full p-4">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-bold text-amber-400 font-[Cinzel] mb-2 drop-shadow-lg">古代遺物</h2>
                <p class="text-slate-400 text-sm">命運的饋贈，選擇一種力量</p>
            </div>
            <div id="relic-container" class="flex flex-wrap justify-center gap-4 w-full max-w-4xl">
            </div>
            <div class="mt-8 flex flex-col items-center gap-3">
                <button id="confirm-relic-btn" onclick="game.confirmRelicSelection()" class="btn-main" style="display: none;">
                    確認並繼續
                </button>
                <button onclick="game.skipRelic()" class="text-slate-500 hover:text-slate-300 text-sm underline cursor-pointer transition-colors">
                    跳過並獲得 500 分
                </button>
            </div>
        </div>
    </div>

    <!-- Info Drawer -->
    <div id="info-drawer" class="absolute bottom-0 left-0 w-full bg-slate-900/95 backdrop-blur-md border-t border-slate-600 text-slate-200 transform transition-transform duration-300 translate-y-full z-50 flex flex-col h-64 safe-area-pb">
        <button onclick="game.ui.closeDrawer()" class="absolute top-2 right-2 text-slate-400 hover:text-white p-2">✕</button>
        <div class="flex border-b border-slate-700 bg-slate-900/50">
            <button class="flex-1 py-3 text-sm font-bold text-amber-400 border-b-2 border-amber-400 tab-btn transition-colors" onclick="game.ui.switchTab('status')">敵人狀態</button>
            <button class="flex-1 py-3 text-sm font-bold text-slate-400 hover:text-slate-200 tab-btn transition-colors" onclick="game.ui.switchTab('affix')">特殊詞條</button>
            <button class="flex-1 py-3 text-sm font-bold text-slate-400 hover:text-slate-200 tab-btn transition-colors" onclick="game.ui.switchTab('recipe')">配方圖鑑</button>
        </div>
        <div class="flex-1 overflow-y-auto p-4 relative">
            <div id="tab-status" class="tab-content h-full space-y-3">
                <div class="flex items-center justify-between">
                    <span class="text-lg font-bold" id="info-enemy-type">普通魔像</span>
                    <span class="text-xs bg-slate-700 px-2 py-1 rounded" id="info-hp">HP: 100/100</span>
                </div>
                <div class="w-full bg-slate-700 h-2 rounded-full overflow-hidden relative mt-1">
                    <div id="info-temp-bar" class="h-full bg-orange-500 absolute transition-all" style="width: 0%; left: 50%;"></div>
                    <div class="absolute top-0 bottom-0 w-0.5 bg-white/50 left-1/2"></div>
                </div>
                <p id="info-temp-text" class="text-xs text-center text-slate-400 mt-1">溫度: 0°C</p>
                <div id="info-status-list" class="space-y-2 text-xs text-slate-300 mt-2">
                </div>
            </div>
            <div id="tab-affix" class="tab-content hidden h-full space-y-2 overflow-y-auto">
                <div id="info-affix-list" class="space-y-2">
                    <p class="text-slate-500 text-center italic mt-4">該敵人無特殊詞條</p>
                </div>
            </div>
            <div id="tab-recipe" class="tab-content hidden h-full overflow-y-auto text-xs space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <div class="bg-slate-800 p-2 rounded border border-slate-700">
                        <div class="text-green-400 font-bold mb-1">⤴️ 彈性 (Bounce)</div>
                        <div class="text-slate-400">在敵人之間彈射，增加命中次數。</div>
                    </div>
                    <div class="bg-slate-800 p-2 rounded border border-slate-700">
                        <div class="text-red-400 font-bold mb-1">↗️ 穿透 (Pierce)</div>
                        <div class="text-slate-400">穿透敵人，對後排造成傷害。</div>
                    </div>
                    <div class="bg-slate-800 p-2 rounded border border-slate-700">
                        <div class="text-yellow-400 font-bold mb-1">🔱 散射 (Scatter)</div>
                        <div class="text-slate-400">分裂出額外子彈，擴大打擊面。</div>
                    </div>
                    <div class="bg-slate-800 p-2 rounded border border-slate-700">
                        <div class="text-cyan-400 font-bold mb-1">❄️ 冰霜 (Cryo)</div>
                        <div class="text-slate-400">降低溫度。極寒可凍結敵人(無法行動)。</div>
                    </div>
                    <div class="bg-slate-800 p-2 rounded border border-slate-700">
                        <div class="text-orange-400 font-bold mb-1">🔥 火焰 (Pyro)</div>
                        <div class="text-slate-400">升高溫度。過熱造成持續傷害與燃燒擴散。</div>
                    </div>
                    <div class="bg-slate-800 p-2 rounded border border-slate-700">
                        <div class="text-purple-400 font-bold mb-1">⚡ 閃電 (Lightning)</div>
                        <div class="text-slate-400">對最近敵人造成連鎖傷害。</div>
                    </div>
                    <div class="bg-slate-800 p-2 rounded border border-slate-700">
                        <div class="text-sky-400 font-bold mb-1">🔦 光球 (Laser)</div>
                        <div class="text-slate-400">瞬時射線，根據反射面進行折射。</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module" src="./src/main.js"></script>
</body>
</html>
